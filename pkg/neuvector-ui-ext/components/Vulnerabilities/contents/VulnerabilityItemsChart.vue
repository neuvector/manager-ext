<script>
import { DoughnutChart } from 'vue-chart-3';
import { Chart, registerables } from 'chart.js';
import { ref, defineComponent } from 'vue';

Chart.register(...registerables);

export default  defineComponent({
    props: {
        countDistribution: Object
    },
    components: {
        DoughnutChart,
    },
    setup(props) {
        const targetDistChartData = ref({
            labels: [['High'], ['Medium'], ['Low']],
            datasets: [
                {
                    hoverBackgroundColor: ['#ef5350', '#ff9800', '#4caf50'],
                    backgroundColor: ['#ef5350', '#ff9800', '#4caf50'],
                    data: [
                        props.countDistribution.high,
                        props.countDistribution.medium,
                        props.countDistribution.low,
                    ],
                },
            ],
        });
        const targetDistChartOptions = ref({
            cutout: 60,
            elements: {
                arc: {
                    borderWidth: 0,
                },
            },
            maintainAspectRatio: false,
            plugins: {
                tooltip: {
                    mode: 'point',
                },
                title: {
                    display: true,
                    text: 'Vulnerabilities Severity Distribution',
                },
                legend: {
                    display: true,
                    labels: {
                        boxWidth: 12,
                    },
                },
            },
        });
        const severityDistChartData = ref({
            labels: [['Platform'], ['Image'], ['Node'], ['Container']],
            datasets: [
                {
                    hoverBackgroundColor: ['#f22d3a', '#86aec2', '#4D5360', '#36A2EB'],
                    backgroundColor: ['#f22d3a', '#86aec2', '#4D5360', '#36A2EB'],
                    data: [
                        props.countDistribution.platform,
                        props.countDistribution.image,
                        props.countDistribution.node,
                        props.countDistribution.container,
                    ],
                },
            ],
        });
        const severityDistChartOption = ref({
            cutout: 60,
            elements: {
                arc: {
                    borderWidth: 0,
                },
            },
            maintainAspectRatio: false,
            plugins: {
                tooltip: {
                    mode: 'point',
                },
                title: {
                    display: true,
                    text: 'Vulnerabilities Target Distribution',
                },
                legend: {
                    display: true,
                    labels: {
                        boxWidth: 12,
                    },
                },
            },
        });
        return {
            targetDistChartData,
            severityDistChartData,
            targetDistChartOptions,
            severityDistChartOption,
        };
    },  
})
</script>

<template>
    <div style="height: 400px">
        <div class="h-50" style="position: relative">
            <DoughnutChart
                style="height: 200px"
                :chartData="severityDistChartData"
                :options="severityDistChartOption">
            </DoughnutChart>
        </div>
        <div class="h-50" style="position: relative">
            <DoughnutChart
                style="height: 200px"
                :chartData="targetDistChartData"
                :options="targetDistChartOptions">
            </DoughnutChart>
        </div>
    </div>
</template>